<!-- Pagos por Cuota -->
<h4>Pagos por Cuota</h4>
<div class="table-responsive">
  <table class="table table-bordered table-striped table-hover align-middle text-center">
    <thead class="table-dark">
      <tr>
        <th>Número de Cuota</th>
        <th>Fecha Registro</th>
        <th>Pagos (ID – Fecha Valor – Monto aplicado)</th>
        <th>Monto del Pago</th>
        <th>Total Aplicado</th>
        <th>Excedente</th>
        <th>Estatus</th>
        <th>Días de Mora</th>
      </tr>
    </thead>
    <tbody>
      {% for cuota, pagos in resultado.items() %}
      <tr>
        <td><strong>{{ cuota }}</strong></td>
        <td>
          {% set pago_principal = pagos[0] %}
          {{ pago_principal.fechaRegistro }}
        </td>
        <td>
          <ul class="list-unstyled mb-0">
            {% for pago in pagos %}
              <li>
                <strong>ID:</strong> {{ pago.idPago }} – 
                <strong>Fecha:</strong> {{ pago.fecha }} – 
                <strong>Aplicado:</strong> ${{ "{:,.2f}".format(pago.aplicado) }}
              </li>
            {% endfor %}
          </ul>
        </td>
        <td>{{ pago_principal.montoPago_original }}</td>
        <td>${{ "{:,.2f}".format(pagos | sum(attribute="aplicado")) }}</td>
        <td>${{ "{:,.2f}".format(pagos | sum(attribute="excedente")) }}</td>
        <td>
          {% if (pagos | sum(attribute="aplicado")) >= datos.cuota %}
            <span class="badge bg-success">Cubierta</span>
          {% else %}
            <span class="badge bg-warning text-dark">Pendiente</span>
          {% endif %}
        </td>
        <td>{{ pago_principal.dias_mora if pago_principal.dias_mora is not none else 'N/A' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
