<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detalle Cliente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .accordion-button { font-weight: 700; color: #222; }
        .info-label { font-weight: 600; color: #495057; }
        .info-value { word-break: break-word; }
        .section-title { margin-top: 1rem; color: #0d6efd; font-size: 1.05rem; font-weight:700; }
        .images img { max-height: 120px; margin: 0.25rem; border-radius: 8px; }
        .btn-back { margin-top: 1.5rem; }
        .group { padding: .35rem 0; border-bottom: 1px dashed #e9ecef; margin-bottom: .5rem; }
        .small-muted { font-size:0.9rem; color:#6c757d; }
    </style>
</head>
<body>
<div class="container py-4">

    {% if resultados %}

        <!-- TABLA GLOBAL (UN REGISTRO POR CLIENTE) -->
        <div class="card mb-4 p-3 shadow-sm">
            <h4 class="mb-3">Resumen Global de Clientes</h4>
            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead class="table-light">
                        <tr>
                            <th>Nombre Cliente</th>
                            <th>ID Crédito</th>
                            <th>CP</th>
                            <th>Teléfono</th>
                            <th>Cuenta CLABE</th>
                            <th>Pago Semanal</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for r in resumen_global %}
                        <tr>
                            <td>{{ r.nombre_cliente }}</td>
                            <td>{{ r.id_credito }}</td>
                            <td>{{ r.cp }}</td>
                            <td>{{ r.telefono_celular }}</td>
                            <td>{{ r.cuenta_clabe }}</td>
                            <td>{{ r.pago_semanal }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ACORDEONES POR CLIENTE -->
        <div class="accordion" id="accordionClientes">
            {% for r in resultados %}
            <div class="accordion-item mb-3">
                <h2 class="accordion-header" id="heading{{ loop.index }}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}">
                        {{ r.nombre_completo_cliente or r.nombre_cliente }} — Crédito: {{ r.id_credito }} — {{ r.estatus }}
                    </button>
                </h2>

                <div id="collapse{{ loop.index }}" class="accordion-collapse collapse" data-bs-parent="#accordionClientes">
                    <div class="accordion-body">

                        <!-- IDENTIFICACIÓN Y ASIGNACIÓN -->
                        <h5 class="section-title">Identificación y asignación</h5>
                        <div class="group row">
                            <div class="col-md-4 info-label">ID:</div><div class="col-md-8 info-value">{{ r.id }}</div>
                            <div class="col-md-4 info-label">id_team:</div><div class="col-md-8 info-value">{{ r.id_team }}</div>
                            <div class="col-md-4 info-label">team_supervisor:</div><div class="col-md-8 info-value">{{ r.team_supervisor }}</div>
                            <div class="col-md-4 info-label">id_base:</div><div class="col-md-8 info-value">{{ r.id_base }}</div>
                            <div class="col-md-4 info-label">nombre_base:</div><div class="col-md-8 info-value">{{ r.nombre_base }}</div>
                            <div class="col-md-4 info-label">fecha_carga_base:</div><div class="col-md-8 info-value">{{ r.fecha_carga_base }}</div>
                            <div class="col-md-4 info-label">id_registro:</div><div class="col-md-8 info-value">{{ r.id_registro }}</div>
                            <div class="col-md-4 info-label">id_key:</div><div class="col-md-8 info-value">{{ r.id_key }}</div>
                            <div class="col-md-4 info-label">usuario_asignado:</div><div class="col-md-8 info-value">{{ r.usuario_asignado }}</div>
                            <div class="col-md-4 info-label">codigo_gestor:</div><div class="col-md-8 info-value">{{ r.codigo_gestor }}</div>
                            <div class="col-md-4 info-label">usuario (sistema):</div><div class="col-md-8 info-value">{{ r.usuario }}</div>
                        </div>

                        <!-- CONTACTOS Y REFERENCIAS -->
                        <h5 class="section-title">Contactos y referencias</h5>
                        <div class="group row">
                            <div class="col-md-4 info-label">Referencia 1:</div><div class="col-md-8 info-value">{{ r.referencia_personal1 }} - {{ r.parentesco1 }} - {{ r.telefono_referencia1 }}</div>
                            <div class="col-md-4 info-label">Referencia 2:</div><div class="col-md-8 info-value">{{ r.referencia_personal2 }} - {{ r.parentesco2 }} - {{ r.telefono_referencia2 }}</div>
                            <div class="col-md-4 info-label">Contacto:</div><div class="col-md-8 info-value">{{ r.contacto }}</div>
                            <div class="col-md-4 info-label">Medio CCC:</div><div class="col-md-8 info-value">{{ r.medio_contactacion_ccc }}</div>
                            <div class="col-md-4 info-label">Medio Campo:</div><div class="col-md-8 info-value">{{ r.medio_contactacion_campo }}</div>
                            <div class="col-md-4 info-label">Dictamen Campo:</div><div class="col-md-8 info-value">{{ r.dictamen_campo }}</div>
                            <div class="col-md-4 info-label">Dictamen CCC:</div><div class="col-md-8 info-value">{{ r.dictamen_ccc }}</div>
                        </div>

                        <!-- DIRECCIONES Y UBICACIÓN -->
                        <h5 class="section-title">Direcciones y ubicación</h5>
                        <div class="group row">
                            <div class="col-md-4 info-label">Dirección:</div><div class="col-md-8 info-value">{{ r.direccion }}</div>
                            <div class="col-md-4 info-label">Dirección INE:</div><div class="col-md-8 info-value">{{ r.direccion_ine }}</div>
                            <div class="col-md-4 info-label">Dirección actual:</div><div class="col-md-8 info-value">{{ r.direccion_actual }}</div>
                            <div class="col-md-4 info-label">Dirección geo:</div><div class="col-md-8 info-value">{{ r.direccion_geo }}</div>
                            <div class="col-md-4 info-label">Geolocalización:</div><div class="col-md-8 info-value">{{ r.geolocalizacion }}</div>
                            <div class="col-md-4 info-label">Longitud:</div><div class="col-md-8 info-value">{{ r.longitud }}</div>
                            <div class="col-md-4 info-label">Latitud:</div><div class="col-md-8 info-value">{{ r.latitud }}</div>
                            <div class="col-md-4 info-label">Ubicación usuario:</div><div class="col-md-8 info-value">{{ r.ubicacion_usuario }}</div>
                        </div>

                        <!-- DOCUMENTOS Y MULTIMEDIA -->
                        <h5 class="section-title">Documentos y multimedia</h5>
                        <div class="group">
                            <div class="images">
                                {% if r.foto1 %}<img src="{{ r.foto1 }}" alt="Foto 1">{% endif %}
                                {% if r.foto2 %}<img src="{{ r.foto2 }}" alt="Foto 2">{% endif %}
                                {% if r.foto3 %}<img src="{{ r.foto3 }}" alt="Foto 3">{% endif %}
                            </div>
                            <div class="mt-2">
                                {% if r.adjunto %}<a href="{{ r.adjunto }}" class="btn btn-sm btn-outline-primary me-2" target="_blank">Adjunto</a>{% endif %}
                                {% if r.video %}<a href="{{ r.video }}" class="btn btn-sm btn-outline-secondary me-2" target="_blank">Video</a>{% endif %}
                                {% if r.images %}<span class="small-muted">images: {{ r.images }}</span>{% endif %}
                            </div>
                        </div>

                        <!-- BOTÓN ACCIONES / NUEVA BÚSQUEDA -->
                        <div class="mt-3">
                            <a href="/busqueda_base_cliente" class="btn btn-primary">Nueva Búsqueda</a>
                        </div>

                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

    {% else %}
        <div class="alert alert-warning">No hay resultados para mostrar.</div>
    {% endif %}

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
