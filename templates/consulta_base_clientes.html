<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detalle Cliente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .accordion-button { font-weight: 700; color: #222; }
        .info-label { font-weight: 600; color: #495057; }
        .info-value { word-break: break-word; }
        .section-title { margin-top: 1rem; color: #0d6efd; font-size: 1.05rem; font-weight:700; }
        .images img { max-height: 120px; margin: 0.25rem; border-radius: 8px; }
        .btn-back { margin-top: 1.5rem; }
        .group { padding: .35rem 0; border-bottom: 1px dashed #e9ecef; margin-bottom: .5rem; }
        .small-muted { font-size:0.9rem; color:#6c757d; }
    </style>
</head>
<body>

<div class="header-bar d-flex justify-content-between align-items-center">
  <div class="d-flex align-items-center">
    <img src="https://maxikash.mx/cdn/shop/files/Logotipo-Maxikash-Outline.png?v=1749328460" alt="Logo" class="logo me-3">
  </div>
  {% if session.get('usuario') %}
  <div class="text-end">
    <a href="/documentos" class="btn btn-outline-primary logout-btn">Consulta Documentos</a>
    <a href="/logout" class="btn btn-outline-danger logout-btn">Cerrar sesión</a>
  </div>
  {% endif %}
</div>

<div class="container py-4">

    {% if resultados %}

        <!-- TABLA GLOBAL (UN REGISTRO POR CLIENTE) -->
        <div class="card mb-4 p-3 shadow-sm">

            <h4 class="mb-3">Resumen Global de Clientes</h4>
            <!-- BOTÓN ACCIONES / NUEVA BÚSQUEDA -->
            <div class="mt-3">
                <a href="/busqueda_base_cliente" class="btn btn-primary">Nueva Búsqueda</a>
            </div>
            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead class="table-light">
                        <tr>
                            <th>Nombre Cliente</th>
                            <th>ID Crédito</th>
                            <th>CP</th>
                            <th>Teléfono</th>
                            <th>Cuenta CLABE</th>
                            <th>Pago Semanal</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set vistos = [] %}
                        {% for r in resultados %}
                            {% if r.id_credito not in vistos %}
                                <tr>
                                    <td>{{ r.nombre_completo_cliente }}</td>
                                    <td>{{ r.id_credito }}</td>
                                    <td>{{ r.cp }}</td>
                                    <td>{{ r.telefono_celular }}</td>
                                    <td>{{ r.cuenta_clabe }}</td>
                                    <td>{{ r.pago_semanal }}</td>
                                </tr>
                                {% do vistos.append(r.id_credito) %}
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ACORDEONES POR CLIENTE -->
        <div class="accordion" id="accordionClientes">
            {% for r in resultados %}
            <div class="accordion-item mb-3">
                <h2 class="accordion-header" id="heading{{ loop.index }}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}">
                        {{ r.nombre_cliente }} — {{ r.estatus }}
                    </button>
                </h2>

                <div id="collapse{{ loop.index }}" class="accordion-collapse collapse" data-bs-parent="#accordionClientes">
                    <div class="accordion-body">

                        <!-- IDENTIFICACIÓN Y ASIGNACIÓN -->
                        <h5 class="section-title">Identificación y asignación</h5>
                        <table class="table table-bordered table-striped">
                            <thead class="table-light">
                                <tr>
                                    <th>team_supervisor</th>
                                    <th>id_base</th>
                                    <th>nombre_base</th>
                                    <th>fecha_carga_base</th>
                                    <th>usuario_asignado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ r.team_supervisor }}</td>
                                    <td>{{ r.id_base }}</td>
                                    <td>{{ r.nombre_base }}</td>
                                    <td>{{ r.fecha_carga_base }}</td>
                                    <td>{{ r.usuario_asignado }}</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- CONTACTOS Y REFERENCIAS -->
                        <h5 class="section-title">Contactos y referencias</h5>
                        <table class="table table-bordered table-striped">
                            <thead class="table-light">
                                <tr>
                                    <th>Contacto</th>
                                    <th>Medio Campo</th>
                                    <th>Dictamen Campo</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ r.contacto }}</td>
                                    <td>{{ r.medio_contactacion_campo }}</td>
                                    <td>{{ r.dictamen_campo }}</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- DIRECCIONES Y UBICACIÓN -->
                        <h5 class="section-title">Direcciones y ubicación</h5>
                        <table class="table table-bordered table-striped">
                            <thead class="table-light">
                                <tr>
                                    <th>Dirección</th>
                                    <th>Dirección geo</th>
                                    <th>Geolocalización</th>
                                    <th>Ubicación usuario</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ r.direccion }}</td>
                                    <td>{{ r.direccion_ine }}</td>
                                    <td>{{ r.direccion_actual }}</td>
                                    <td>{{ r.direccion_geo }}</td>
                                    <td>{{ r.geolocalizacion }}</td>
                                    <td>{{ r.ubicacion_usuario }}</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- DOCUMENTOS Y MULTIMEDIA -->
                        <h5 class="section-title">Documentos y multimedia</h5>
                        <div class="group">
                            <div class="mt-2">
                                {% if r.images %}
                                   <span class="small-muted">
    images: <a href="{{ r.images }}" target="_blank">{{ r.images }}</a>
</span>
                                {% endif %}
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

    {% else %}
        <div class="alert alert-warning">No hay resultados para mostrar.</div>
    {% endif %}

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
